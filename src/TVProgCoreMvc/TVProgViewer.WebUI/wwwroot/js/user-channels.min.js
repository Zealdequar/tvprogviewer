function fillSelects(){$.ajax({url:"/Programme/GetTvProviderList",dataType:"json",async:!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t;for($("#TVProgType").empty(),t=0;t<n.length;t++)$("#TVProgProvider option").filter(function(){return $(this).html()===n[t].ProviderName}).val()||$("#TVProgProvider").append($("<option>",{value:n[t].TVProgProviderID}).text(n[t].ProviderName));for(t=0;t<n.length;t++)!$("#TVProgType option").filter(function(){return $(this).html()===n[t].TypeProgID}).val()&&$("#TVProgProvider option:selected").filter(function(){return $(this).html()===n[t].ProviderName}).val()&&$("#TVProgType").append($("<option>",{value:n[t].TypeProgID}).text(n[t].TypeName))}})}function UploadImage(n,t){var i=new FormData;return i.append("file",$("#FileName25")[0].files[0]),i.append("userChannelId",t.UserChannelID),$.ajax({url:"/Channel/UploadFile",type:"POST",data:i,processData:!1,contentType:!1,success:function(){reload();setGrid()},error:function(){}}),[!0,"",!1]}function setGrid(){var n;$("#tblUserChannels").jqGrid({url:"/Channel/GetUserChannels?tvProgProvider="+$("#TVProgProvider option:selected").val()+"&progType="+$("#TVProgType option:selected").val(),datatype:"json",mtype:"Get",success:function(){},colNames:["","","Вкл./Выкл.","Логотип","Канал","Пользовательское название","Номер канала","Сдвиг по времени","Действие"],colModel:[{key:!0,name:"UserChannelID",index:"UserChannelID",width:"0px",hidden:!0,editable:!0},{key:!0,name:"ChannelID",index:"ChannelID",width:"0px",hidden:!0,editable:!0},{key:!1,name:"Visible",index:"Visible",sortable:!0,width:"3%",align:"center",formatter:"checkbox",formatoptions:{disabled:!1},editable:!0},{key:!1,name:"FileName25",index:"FileName25",sortable:!1,width:"3%",align:"center",formatter:function(n){return n?n.indexOf("Логотип")===-1?"<img src='"+n+"' alt='Логотип канала' />":n:"<img src='/imgs/i/satellite_25.png' alt='Логотип канала' />"},editable:!0,edittype:"file",editoptions:{enctype:"multipart/form-data"},search:!1},{key:!1,name:"SystemTitle",index:"SystemTitle",sortable:!0,width:"20%",editable:!1},{key:!1,name:"UserTitle",index:"UserTitle",sortable:!0,width:"20%",editable:!0},{key:!1,name:"OrderCol",index:"OrderCol",sortable:!0,width:"10%",align:"center",editable:!0},{key:!1,name:"Diff",index:"Diff",sortable:!0,width:"10%",align:"center",editable:!0},{name:"Actions",index:"Actions",width:100,editable:!1,sortable:!1,align:"center",fixed:!0,hidedlg:!0,resizeable:!1,search:!1,viewable:!1,template:"actions",formatoptions:{keys:!0,editformbutton:!0,delbutton:!1}}],rowNum:20,loadComplete:function(){$("tr.jqgrow:odd").css("background","#EFFFEF")},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:"100%",autowidth:!0,rownumbers:!0,viewrecords:!0,reloadAfterEdit:!0,multiselect:!1,onSelectRow:function(t){t&&t!==n&&(jQuery("#tblUserChannels").jqGrid("restoreRow",n),jQuery("#tblUserChannels").jqGrid("editRow",t,!0),n=t)},caption:"Настройка телеканалов",emptyrecords:"Телеканалы не обнаружены",formEditing:{width:400,zIndex:100,closeOnEscape:!0,closeAfterEdit:!0,reloadAfterSubmit:!0,afterSubmit:function(n,t){return UploadImage(n,t),$(this).jqGrid("setGridParam",{datatype:"json"}),[!0]}},jsonReader:{repeatitems:!1,root:function(n){return n},page:function(){return 1},total:function(n){return n.rowNum/n.height},records:function(n){return n.length}},pager:"#userChannelsPager",editurl:"/Channel/UpdateChannel?tvProgProviderID="+$("#TVProgProvider option:selected").val(),loadonce:!0,reloadAfterSubmit:!0,afterSubmit:UploadImage,onInitializeForm:function(n){$(n).attr("method","POST");$(n).attr("action","");$(n).attr("enctype","multipart/form-data")}}).navGrid("#userChannelsPager",{edit:!0,add:!1,del:!1,search:!0,searchtext:"Поиск телеканала",refresh:!0},{zIndex:100,width:400,caption:"Поиск телеканала",sopt:["cn"],reloadAfterSubmit:!0,closeAfterEdit:!0,afterSubmit:UploadImage})}function reload(){$("#tblUserChannels").jqGrid("GridUnload")}$(function(){fillSelects();setGrid();$("#TVProgProvider").change(function(){fillSelects();$("#tblUserChannels").jqGrid("GridUnload");setGrid()});$("#TVProgType").change(function(){$("#tblUserChannels").jqGrid("GridUnload");setGrid()});$("#choicePnl").show()});