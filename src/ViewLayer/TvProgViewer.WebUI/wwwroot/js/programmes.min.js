function fillFooter(){$("#userTypeProg option:selected")&&$("#userTypeProg option:selected").val().split(";")[1]&&$.ajax({url:"Home/GetSystemProgrammePeriod?progType="+$("#userTypeProg option:selected").val().split(";")[1],dataType:"json",type:"GET",contentType:"application/json; charset=utf-8",success:function(n){if(n){var t=new Date(Date.parse(n.dtStart)),i=new Date(Date.parse(n.dtEnd));$("#period").text(formatDateString(t)+" — "+formatDateString(i))}},error:function(n){n.statusText}})}function formatDateString(n){var t=("0"+n.getDate()).slice(-2),i=("0"+(n.getMonth()+1)).slice(-2),r=n.getFullYear();return t+"."+i+"."+r}function numDateString(n){var t=("0"+n.getDate()).slice(-2),i=("0"+(n.getMonth()+1)).slice(-2),r=n.getFullYear();return r+""+i+""+t}function setGrids(){$("#TVProgrammeNowGrid").jqGrid({url:"Home/GetSystemProgrammeAtNow?progType="+$("#userTypeProg option:selected").val().split(";")[1]+"&category="+$("#userCategory option:selected").val().split(";")[1]+"&genres="+GetGenres(".btn-genre-now.active")+"&channels="+(chansArr?chansArr.map(n=>n.ChannelId).join(";"):""),datatype:"json",type:"GET",success:function(){},error:function(){console.log("ERROR")},colNames:["Рейтинг","Название рейтинга","Жанр","Название жранра","Анонс","Эмблема канала","Название канала","Передача","Начало","Окончание","Осталось, %","",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:"2%",align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,width:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:"2%",align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:"2%",align:"center",formatter:imgAnons},{key:!1,name:"ChannelContent",index:"ChannelContent",sortable:!0,width:"3%",align:"center",formatter:imgChannel},{key:!1,name:"ChannelName",index:"ChannelName",sortable:!0,width:"5%"},{key:!1,name:"TelecastTitle",index:"TelecastTitle",sortable:!0,width:"20%"},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:"3%",sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:"3%",sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Remain",index:"Remain",sortable:!0,width:"5%",formatter:function(n){return"<div style='position: relative'><div class='remain-progress'>"+n+"%<\/div><div class='progress-bar progress-bar-striped' role='progressbar' aria-valuemin='100' aria-valuemax='1' style='width: "+n+"%; position: relative; height: 23px; float: right;'><\/div><\/div>"}},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0},{key:!1,name:"OrderCol",index:"OrderCol",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeNowGrid").jqGrid("resetSelection"),!0},loadComplete:function(){$(this).find("tr.jqgrow:odd").addClass("alt-green-background");$("tr.jqgrow td input","#TVProgrammeNowGrid").on("click",function(){$(this).closest("tr").find("td:nth-child(6)").find("img").length?($("#mainToolNow").show(50),$("#anonsTool").show(50),$("#anonsDescr").html($(this).closest("tr").find("td:nth-child(13)").attr("title"))):($("#anonsTool").hide(50),$("#mainToolNow").hide(50),$("#anonsDescr").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,autoResizing:{minColWidth:80},viewrecords:!0,caption:"Программа передач на сейчас | Что сейчас показывают на телевидении | Сколько процентов от времени передачи осталось до окончания",emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammePager",loadonce:!1,forceClientSorting:!0,multiselect:!0}).navGrid("#TVProgrammePager",{edit:!1,add:!1,del:!1,search:!1,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]});jQuery("#TVProgrammeNowGrid").jqGrid("hideCol","GenreName");jQuery("#TVProgrammeNowGrid").jqGrid("hideCol","RatingName");jQuery("#TVProgrammeNowGrid").jqGrid("hideCol","RatingContent");jQuery("#TVProgrammeNowGrid").jqGrid("setGridWidth",$("#mw").width());jQuery("#TVProgrammeNowGrid").jqGrid("setGridHeight",548);$(".drag-tool-genre").width($("#mw").width());$("#TVProgrammeNextGrid").jqGrid({url:"Home/GetSystemProgrammeAtNext?progType="+$("#userTypeProg option:selected").val().split(";")[1]+"&category="+$("#userCategory option:selected").val().split(";")[1]+"&genres="+GetGenres(".btn-genre-next.active")+"&channels="+(chansArr?chansArr.map(n=>n.ChannelId).join(";"):""),datatype:"json",type:"GET",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","Эмблема канала","Название канала","Передача","Начало","Окончание","Осталось","",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:"2%",align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:"2%",align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:"2%",align:"center",formatter:imgAnons},{key:!1,name:"ChannelContent",index:"ChannelContent",sortable:!0,width:"3%",align:"center",formatter:imgChannel},{key:!1,name:"ChannelName",index:"ChannelName",sortable:!0,width:"5%"},{key:!1,name:"TelecastTitle",index:"TelecastTitle",sortable:!0,width:"20%"},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:"3%",sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:"3%",sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Remain",index:"Remain",sortable:!0,align:"center",width:"5%",sorttype:"datetime",formatter:function(n,t,i,r){return $.fn.fmatter.call(this,"date",new Date(n*1e3-108e5),t,i,r)},formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0},{key:!1,name:"OrderCol",index:"OrderCol",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeNextGrid").jqGrid("resetSelection"),!0},loadComplete:function(){$(this).find("tr.jqgrow:odd").addClass("alt-green-background");$("tr.jqgrow td input","#TVProgrammeNextGrid").on("click",function(){$(this).closest("tr").find("td:nth-child(6)").find("img").length?($("#mainToolNext").show(50),$("#anonsToolNext").show(50),$("#anonsDescrNext").html($(this).closest("tr").find("td:nth-child(13)").attr("title"))):($("#mainToolNext").hide(50),$("#anonsToolNext").hide(50),$("#anonsDescrNext").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!1,shrinkToFit:!0,autoResizing:{minColWidth:80},viewrecords:!0,caption:"Телепередачи после текущих передач | Что последует в телеэфире | Через сколько в часах и минутах они начнутся",emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammeNextPager",loadonce:!1,multiselect:!0}).navGrid("#TVProgrammeNextPager",{edit:!1,add:!1,del:!1,search:!1,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]});jQuery("#TVProgrammeNextGrid").jqGrid("hideCol","GenreName");jQuery("#TVProgrammeNextGrid").jqGrid("hideCol","RatingName");jQuery("#TVProgrammeNextGrid").jqGrid("hideCol","RatingContent");jQuery("#TVProgrammeNextGrid").jqGrid("setGridWidth",$("#mw2").width());jQuery("#TVProgrammeNextGrid").jqGrid("setGridHeight",548);$(".drag-tool-genre").width($("#mw2").width())}function searchProgramme(n,t){incSearch==1?($("#SearchedTVProgramme").jqGrid({url:"Home/SearchProgramme?progType="+n+"&findTitle="+t+"&category="+$("#userCategory option:selected").val().split(";")[1]+"&genres="+getSearchGenres(".chkGenres:checkbox:checked")+"&dates="+getSearchDates(".chkDates:checkbox:checked")+"&channels="+getSearchChannels(".chkChannels:checkbox:checked"),datatype:"json",type:"GET",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","Эмблема канала","Название канала","День","От","До","Передачи",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:40,align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:"46px",align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:"43px",align:"center",formatter:imgAnons},{key:!1,name:"ChannelContent",index:"ChannelContent",sortable:!0,align:"center",formatter:imgChannel},{key:!1,name:"ChannelName",index:"ChannelName",sortable:!0},{key:!1,name:"DayMonth",index:"DayMonth",sortable:!0,align:"center",width:100},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:55,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:55,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastTitle",index:"TelecastTitle",sortable:!0,width:556},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#SearchedTVProgramme").jqGrid("resetSelection"),!0},loadComplete:function(){$(this).find("tr.jqgrow:odd").addClass("alt-green-background");$("tr.jqgrow td input","#SearchedTVProgramme").on("click",function(){$(this).closest("tr").find("td:nth-child(6)").find("img").length?($("#mainToolSearch").show(50),$("#anonsToolSearch").show(50),$("#anonsDescrSearch").html($(this).closest("tr").find("td:nth-child(13)").attr("title"))):($("#anonsToolSearch").hide(50),$("#mainToolSearch").hide(50),$("#anonsDescrSearch").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,viewrecords:!0,caption:"Список найденных передач из эфирной сетки | Телепередачи, которые вы ищете | Результаты поиска по программе передач",emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammeSearchPager",loadonce:!1,forceClientSorting:!0,multiselect:!0,gridview:!0,rowattr:function(n){var t=new Date(Date.parse(n.Stop)),i=new Date;return i>t?{"class":"grayColor"}:{"class":"blackColor"}}}).navGrid("#TVProgrammeSearchPager",{edit:!1,add:!1,del:!1,search:!1,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]}),jQuery("#SearchedTVProgramme").jqGrid("hideCol","GenreName"),jQuery("#SearchedTVProgramme").jqGrid("hideCol","RatingName"),jQuery("#SearchedTVProgramme").jqGrid("setGridWidth",$("#mw3").width()),jQuery("#SearchedTVProgramme").jqGrid("setGridHeight",548)):($("#SearchedTVProgramme").setGridParam({url:"Home/SearchProgramme?progType="+n+"&findTitle="+t+"&category="+$("#userCategory option:selected").val().split(";")[1]+"&genres="+getSearchGenres(".chkGenres:checkbox:checked")+"&dates="+getSearchDates(".chkDates:checkbox:checked")+"&channels="+getSearchChannels(".chkChannels:checkbox:checked")}),$("#SearchedTVProgramme").trigger("reloadGrid"));incSearch++}function setTree(n){var t="Home/GetTreeData?providerId="+$("#userProvider option:selected").val().split(";")[1]+"&typeProg="+$("#userTypeProg option:selected").val().split(";")[1]+"&jsonChannels="+window.localStorage.getItem("optChans")+"&mode="+(n-1);n===2?($("#containerByDays").jstree({core:{data:{url:t,dataType:"json"}}}),$("#containerByDays").jstree(!0).settings.core.data.url=t,$("#containerByDays").jstree("refresh")):n===3&&($("#containerByChannels").jstree({core:{data:{url:t,dataType:"json"}}}),$("#containerByChannels").jstree(!0).settings.core.data.url=t,$("#containerByChannels").jstree("refresh"))}function getSelectedTabIndex(){return idx}function fillUserByDay(n,t){incChannelByDay==1?($("#TVProgrammeByDaysGrid").jqGrid({url:"Home/GetUserProgrammeOfDay?progTypeID="+$("#userTypeProg option:selected").val().split(";")[1]+"&cid="+t+"&tsDate="+n+"&category="+$("#userCategory option:selected").val().split(";")[1],datatype:"json",type:"GET",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","От","До","Передача",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:40,align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:40,align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:40,align:"center",formatter:imgAnons},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastTitle",index:"TelecastTitle",width:850,sortable:!0},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeByDaysGrid").jqGrid("resetSelection"),!0},loadComplete:function(){$(this).find("tr.jqgrow:odd").addClass("alt-green-background");$("tr.jqgrow td input","#TVProgrammeByDaysGrid").on("click",function(){$(this).closest("tr").find("td:nth-child(6)").find("img").length?($("#mainToolByDays").show(50),$("#anonsToolByDays").show(50),$("#anonsDescrByDays").html($(this).closest("tr").find("td:nth-child(10)").attr("title"))):($("#mainToolByDays").hide(50),$("#anonsToolByDays").hide(50),$("#anonsDescrByDays").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,viewrecords:!0,caption:"Программа передач по телеканалу на определённый день",shrinkToFit:!0,emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammeByDaysPager",loadonce:!1,multiselect:!0,gridview:!0,rowattr:function(n){var i=new Date(Date.parse(n.Start)),r=new Date(Date.parse(n.Stop)),t=new Date;return r<t?{"class":"grayColor"}:i<=t&&r>t?{"class":"blackColor"}:i>t?{"class":"greenColor"}:void 0}}).navGrid("#TVProgrammeByDaysPager",{edit:!1,add:!1,del:!1,search:!1,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]}),$("#TVProgrammeByDaysGrid").jqGrid("hideCol","GenreName"),$("#TVProgrammeByDaysGrid").jqGrid("hideCol","RatingName"),jQuery("#TVProgrammeByDaysGrid").jqGrid("setGridWidth",$("#mw5").width()),jQuery("#TVProgrammeByDaysGrid").jqGrid("setGridHeight",548)):($("#TVProgrammeByDaysGrid").setGridParam({url:"Home/GetUserProgrammeOfDay?progTypeID="+$("#userTypeProg option:selected").val().split(";")[1]+"&cid="+t+"&tsDate="+n+"&category="+$("#userCategory option:selected").val().split(";")[1]}),$("#TVProgrammeByDaysGrid").trigger("reloadGrid"));incChannelByDay++;jQuery("#TVProgrammeByDaysGrid").jqGrid("setGridWidth",$("#mw5").width());jQuery("#TVProgrammeByDaysGrid").jqGrid("setGridHeight",548);$(".drag-tool-genre").width($("#mw5").width())}function fillUserByChannels(n,t){incDayByChannel==1?($("#TVProgrammeByChannelsGrid").jqGrid({url:"Home/GetUserProgrammeOfDay?progTypeID="+$("#userTypeProg option:selected").val().split(";")[1]+"&cid="+t+"&tsDate="+n+"&category="+$("#userCategory option:selected").val().split(";")[1],datatype:"json",type:"GET",colNames:["Рейтинг","Название рейтинга","Жанр","Название жанра","Анонс","От","До","Передача",""],colModel:[{key:!1,name:"RatingContent",index:"RatingContent",sortable:!0,width:40,align:"center",formatter:imgRating,cellattr:function(n,t,i){return'title="'+i.RatingName+'"'}},{key:!1,name:"RatingName",index:"RatingName",sortable:!0,widht:"0",align:"center"},{key:!1,name:"GenreContent",index:"GenreContent",sortable:!0,width:40,align:"center",formatter:imgGenre,cellattr:function(n,t,i){return'title="'+i.GenreName+'"'}},{key:!1,name:"GenreName",index:"GenreName",sortable:!0,width:"0",align:"center"},{key:!1,name:"AnonsContent",index:"AnonsContent",sortable:!0,width:40,align:"center",formatter:imgAnons},{key:!1,name:"Start",index:"Start",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"Stop",index:"Stop",sortable:!0,align:"center",width:80,sorttype:"datetime",formatter:"date",formatoptions:{srcformat:"ISO8601Long",newformat:"H:i"}},{key:!1,name:"TelecastTitle",index:"TelecastTitle",width:850,sortable:!0},{key:!1,name:"TelecastDescr",index:"TelecastDescr",hidden:!0}],rowNum:20,beforeSelectRow:function(){return $("#TVProgrammeByChannelsGrid").jqGrid("resetSelection"),!0},loadComplete:function(){$("tr.jqgrow:odd").css("background","#EFFFEF");$("tr.jqgrow td input","#TVProgrammeByChannelsGrid").on("click",function(){$(this).closest("tr").find("td:nth-child(6)").find("img").length?($("#mainToolByChannels").show(50),$("#anonsToolByChannels").show(50),$("#anonsDescrByChannels").html($(this).closest("tr").find("td:nth-child(10)").attr("title"))):($("#mainToolByChannels").hide(50),$("#anonsToolByChannels").hide(50),$("#anonsDescrByChannels").hide(150))})},rowList:[10,20,30,40,50,100,500,1e3],height:"auto",width:null,autowidth:!0,shrinkToFit:!0,viewrecords:!0,caption:"Программа передач по дням на определённый телеканал",emptyrecords:"Программа передач не обнаружена",pager:"#TVProgrammeByChannelsPager",loadonce:!1,multiselect:!0,gridview:!0,rowattr:function(n){var i=new Date(Date.parse(n.Start)),r=new Date(Date.parse(n.Stop)),t=new Date;return r<t?{"class":"grayColor"}:i<=t&&r>t?{"class":"blackColor"}:i>t?{"class":"greenColor"}:void 0}}).navGrid("#TVProgrammeByChannelsPager",{edit:!1,add:!1,del:!1,search:!1,searchtext:"Поиск передачи",refresh:!0},{zIndex:100,caption:"Поиск передачи",sopt:["cn"]}),jQuery("#TVProgrammeByChannelsGrid").jqGrid("hideCol","GenreName"),jQuery("#TVProgrammeByChannelsGrid").jqGrid("hideCol","RatingName")):($("#TVProgrammeByChannelsGrid").setGridParam({url:"Home/GetUserProgrammeOfDay?progTypeID="+$("#userTypeProg option:selected").val().split(";")[1]+"&cid="+t+"&tsDate="+n+"&category="+$("#userCategory option:selected").val().split(";")[1]}),$("#TVProgrammeByChannelsGrid").trigger("reloadGrid"));incDayByChannel++;jQuery("#TVProgrammeByChannelsGrid").jqGrid("setGridWidth",$("#mw6").width());jQuery("#TVProgrammeByChannelsGrid").jqGrid("setGridHeight",548);$(".drag-tool-genre").width($("#mw6").width())}function getSearchGenres(n){var t=$(n).map(function(){return this.id.replace("Genre","")}).get();return t.join(";")}function getSearchDates(n){var t=$(n).map(function(){return this.id.replace("Date","")}).get();return t.join(";")}function getSearchChannels(n){var t=$(n).map(function(){return this.id.replace("Channel","")}).get();return t.join(";")}function fillGenresToolNow(){$("#genresToolNow").hide();$.ajax({url:"Home/GetGenres",dataType:"json","async":!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t,i;for($("#genresToolNow").empty(),t=0;t<n.length;t++)i=$('<button id="'+n[t].GenreId+'" class="btn btn-default btn-genre-now">'),$("#genresToolNow").append(i.html('<img src="'+n[t].GenrePath+'" title="'+n[t].GenreName+'" alt="'+n[t].GenreName+'" height="24px" width="24px">'));$(".btn-group-genres-now").on("click",".btn",function(n){n.preventDefault();$(this).toggleClass("active");$("#TVProgrammeNowGrid").setGridParam({url:"Home/GetSystemProgrammeAtNow?progType="+$("#userTypeProg option:selected").val().split(";")[1]+"&category="+$("#userCategory option:selected").val().split(";")[1]+"&genres="+GetGenres(".btn-genre-now.active")+"&channels="+(chansArr?chansArr.map(n=>n.ChannelId).join(";"):"")});$("#TVProgrammeNowGrid").trigger("reloadGrid")});window.setTimeout(function(){$("#genresToolNow").show()},500)},error:function(n,t){var i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText}})}function fillGenresToolNext(){$("#genresToolNext").hide();$.ajax({url:"Home/GetGenres",dataType:"json","async":!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){var t,i;for($("#genresToolNext").empty(),t=0;t<n.length;t++)i=$('<button id="'+n[t].GenreId+'" class="btn btn-default btn-genre-next">'),$("#genresToolNext").append(i.html('<img src="'+n[t].GenrePath+'" title="'+n[t].GenreName+'" alt="'+n[t].GenreName+'" height="24px" width="24px">'));$(".btn-group-genres-next").on("click",".btn",function(n){n.preventDefault();$(this).toggleClass("active");$("#TVProgrammeNextGrid").setGridParam({url:"Home/GetSystemProgrammeAtNext?progType="+$("#userTypeProg option:selected").val().split(";")[1]+"&category="+$("#userCategory option:selected").val().split(";")[1]+"&genres="+GetGenres(".btn-genre-next.active")+"&channels="+(chansArr?chansArr.map(n=>n.ChannelId).join(";"):"")});$("#TVProgrammeNextGrid").trigger("reloadGrid")});window.setTimeout(function(){$("#genresToolNext").show()},3e3)},error:function(n,t){var i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText}})}function fillGenresToolSearch(){$.ajax({url:"Home/GetGenres",dataType:"json","async":!1,type:"Get",contentType:"application/json; charset=utf-8",success:function(n){$("#genreToolSearch").empty();for(var t=0;t<n.length;t++)$("#genreToolSearch").append('<div class="row search-conditions">'+appendGenreColumn(n[t])+"<\/div>")},error:function(n,t){var i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText}})}function fillChannelsToolSearch(){$("#userProvider option:selected")&&$("#userProvider option:selected").val().split(";")[1]&&$.ajax({url:"Home/GetChannels?providerId="+$("#userProvider option:selected").val().split(";")[1]+"&jsonChannels="+window.localStorage.getItem("optChans"),dataType:"json",type:"GET",contentType:"application/json; charset=utf-8",success:function(n){for(var i=n,t=1;t<=i.length;t++)$("#channelToolSearch").append('<div class="row search-conditions">'+appendChannelColumn(i[t-1])+"<\/div>")}})}function fillDatesToolSearch(){$("#userTypeProg option:selected")&&$("#userTypeProg option:selected").val().split(";")[1]&&$.ajax({url:"Home/GetSystemProgrammePeriod?progType="+$("#userTypeProg option:selected").val().split(";")[1],dataType:"json",type:"GET",contentType:"application/json; charset=utf-8",success:function(n){for(var r=new Date(Date.parse(n.dtStart)),u=new Date(Date.parse(n.dtEnd)),i=getDates(r,u),t=1;t<=i.length;t++)$("#datesToolSearch").append('<div class="row search-conditions">'+appendDateColumn(i[t-1])+"<\/div>")}})}function appendDateColumn(n){var t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()).valueOf(),i=new Date(n),u=i>=r?'checked="checked" ':"";return'<div  class="form-group form-check">'+(typeof n!="undefined"?'<input id="Date'+numDateString(n)+'" type="checkbox" '+u+'class="form-check-input chkDates">':"")+(typeof n!="undefined"?'<label class="form-check-label label-of-checkbox" for="Date'+numDateString(n)+'"><img class="pic-of-checkbox" src="/images/i/'+getDayOfWeek(n)+'.png" alt="'+["Вс","Пн","Вт","Ср","Чт","Пт","Сб"][i.getDay()]+'"><\/img>':"")+(typeof n!="undefined"?formatDateString(n):"")+"<\/label><\/div><\/div>"}function appendGenreColumn(n){return'<div class="form-group form-check">'+(typeof n!="undefined"?'<input id="Genre'+n.GenreId+'" type="checkbox" class="form-check-input chkGenres">':"")+(typeof n!="undefined"?'<label class="form-check-label label-of-checkbox" for="Genre'+n.GenreId+'"><img class="pic-genre-of-checkbox" src="'+n.GenrePath+'" title="'+n.GenreName+'" alt="'+n.GenreName+'" height="24px" width="24px"><\/img>':"")+(typeof n!="undefined"?n.GenreName:"")+"<\/label><\/div><\/div>"}function appendChannelColumn(n){return'<div class="form-group form-check">'+(typeof n!="undefined"?'<input id="Channel'+n.ChannelId+'" type="checkbox" checked="checked" class="form-check-input chkChannels">':"")+(typeof n!="undefined"?'<label class="form-check-label label-of-checkbox" for="Channel'+n.ChannelId+'"><img class="pic-channel-of-checkbox" src="'+n.FileName25+'" alt="'+n.Title+'"><\/img>':"")+(typeof n!="undefined"?n.Title:"")+"<\/label><\/div><\/div>"}function getDates(n,t){for(var r=[],i=n;i<=t;)r.push(new Date(i)),i=i.addDays(1);return r}function getDayOfWeek(n){return["Sun","Mon","Tue","Wen","Ths","Fri","Sat"][n.getDay()]}function fillSearchTab(){window.setTimeout(function(){$("#searchPanel").show()},3e3)}function checkSearchAll(){$("#calendarTab").hasClass("active")?$(".chkDates").each(function(){$(this).prop("checked",!0)}):$("#channelTab").hasClass("active")?$(".chkChannels").each(function(){$(this).prop("checked",!0)}):$("#genreTab").hasClass("active")&&$(".chkGenres").each(function(){$(this).prop("checked",!0)})}function uncheckSearchAll(){$("#calendarTab").hasClass("active")?$(".chkDates").each(function(){$(this).prop("checked",!1)}):$("#channelTab").hasClass("active")?$(".chkChannels").each(function(){$(this).prop("checked",!1)}):$("#genreTab").hasClass("active")&&$(".chkGenres").each(function(){$(this).prop("checked",!1)})}function invertSearchAll(){$("#calendarTab").hasClass("active")?$(".chkDates").each(function(){$(this).prop("checked",!$(this).is(":checked"))}):$("#channelTab").hasClass("active")?$(".chkChannels").each(function(){$(this).prop("checked",!$(this).is(":checked"))}):$("#genreTab").hasClass("active")&&$(".chkGenres").each(function(){$(this).prop("checked",!$(this).is(":checked"))})}var idx,pairKeys,incSearch=1,incChannelByDay=1,incDayByChannel=1;let chansArr=[];$(function(){if($.jgrid.no_legacy_api=!0,$.jgrid.useJSON=!0,chansArr=getStorageChannels(),chansArr&&chansArr.length>0)$("tabNow").addClass("active"),$("tabNow").removeClass("disable"),$("tabNext").removeClass("disable"),$("tabSearch").removeClass("disable"),$("tabChannels").removeClass("active"),$(".byDays").show(),$(".byChannels").show();else{$("tabNow").addClass("disable");$("tabNext").addClass("disable");$("tabSearch").addClass("disable");$("tabChannels").addClass("active");return}setTree(getSelectedTabIndex());fillFooter();fillGenresToolNow();fillGenresToolNext();fillGenresToolSearch();fillSearchTab();fillDatesToolSearch();fillChannelsToolSearch();setGrids();$("#tabs").tabs({show:function(){(grid=$(".ui-jqgrid-btable:visible"))&&grid.each(function(){gridId=$(this).attr("id");gridParentWidth=$("#gbox_"+gridId).parent().width();$("#"+gridId).setGridWidth(gridParentWidth)})},activate:function(n,t){if(idx=t.newTab.index(),(idx===2||idx===3)&&setTree(idx),idx===4){var i=document.getElementById("datesToolSearch");i.scrollTop=i.scrollHeight-i.clientHeight}}});$("#anonsTool").on("click",function(){$("#anonsDescr").toggle(100)});$("#anonsToolNext").on("click",function(){$("#anonsDescrNext").toggle(100)});$("#anonsToolSearch").on("click",function(){$("#anonsDescrSearch").toggle(100)});$("#chkAll").on("click",function(){checkSearchAll()});$("#chkUncheckAll").on("click",function(){uncheckSearchAll()});$("#chkInvert").on("click",function(){invertSearchAll()});$("#anonsToolByDays").on("click",function(){$("#anonsDescrByDays").toggle(100)});$("#anonsToolByChannels").on("click",function(){$("#anonsDescrByChannels").toggle(100)});$("#btnSearch").on("click",function(){searchProgramme($("#userTypeProg option:selected").val().split(";")[1],$("#tbContains").val())});$("#containerByDays").on("open_node.jstree",function(n,t){t.node.parents.length===3&&t.instance.set_icon(t.node,t.node.icon.indexOf("_exp")===-1?[t.node.icon.slice(0,13),"_exp",t.node.icon.slice(13)].join(""):t.node.icon)}).on("close_node.jstree",function(n,t){t.node.parents.length===3&&t.instance.set_icon(t.node,t.node.icon.replace("_exp",""))});$("#containerByDays").on("select_node.jstree",function(n,t){var r;if(t.node.parents.length===4){$("#pic").hide(100);$("#pic").attr("src",t.node.icon.replace("/small/","/large/"));$("#pic").show(100);$("#channelText").text(t.node.text);r=t.node.id;pairKeys=r.split("_");$("#dtFull").hide();var i=new Date(pairKeys[0].replace(/(\d+).(\d+).(\d+)/,"$2/$1/$3"));$("#dtFull").text(i.toLocaleDateString("ru-Ru",{day:"numeric"})+" "+["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][i.getMonth()]+" "+i.toLocaleDateString("ru-Ru",{year:"numeric"})+" ("+["Вс","Пн","Вт","Ср","Чт","Пт","Сб"][i.getDay()]+")");$("#dtFull").show();fillUserByDay(pairKeys[0],pairKeys[1])}});$("#containerByChannels").on("select_node.jstree",function(n,t){if(t.node.parents.length===4){var i=t.node.id;pairKeys=i.split("_");fillUserByChannels(pairKeys[0],pairKeys[1])}});$("#dragToolGenreNow").draggable();$("#dragToolGenreNext").draggable()});Date.prototype.yyyymmdd=function(){var n=this.getMonth()+1,t=this.getDate();return[this.getFullYear(),(n>9?"":"0")+n,(t>9?"":"0")+t].join("")};Date.prototype.addDays=function(n){var t=new Date(this.valueOf());return t.setDate(t.getDate()+n),t};