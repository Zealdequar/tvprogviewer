function getUuid(){let n;$.ajax({url:"Home/GetUnidentificator",dataType:"json",type:"GET",contentType:"application/json; charset=utf-8",success:function(n){let t=window.localStorage.getItem("_tv_uuid"),i=JSON.parse(n);return t&&t.length!=0||i.uuid&&i.uuid.length!=0||window.localStorage.setItem("_tv_uuid",crypto.randomUUID()),i.uuid&&i.uuid.length>0&&i.uuid!=t&&(t=i.uuid,window.localStorage.setItem("_tv_uuid",t)),t},error:function(t){n=t.statusText}})}function chAction(){let t=window.localStorage.getItem("optChans");if(t){for(let n in t)checkedArray.push(t[n]);checkedArray=JSON.parse(window.localStorage.getItem("optChans"))}for(var n=0;n<checkedArray.length;n++)checkedArray[n].pageNum==pageNum&&$("#tblSystemChannelsGrid").jqGrid("setSelection",checkedArray[n].rowId,!1);window.localStorage.setItem("optChans","[]")}function sendStatForChannelRating(){let n,t=getStorageChannels();return $.ajax({url:"Home/SendStatForChannelRating?uuid="+window.localStorage.getItem("_tv_uuid")+"&progType="+$("#userTypeProg option:selected").val().split(";")[1]+"&channels="+(t?t.map(n=>n.ChannelId).join(";"):""),dataType:"json",type:"GET",contentType:"application/json; charset=utf-8",success:function(){n="OK"},error:function(t){n=t.statusText}}),n}function UploadImage(n,t){var i=new FormData;return i.append("file",$("#FileName25")[0].files[0]),i.append("userChannelId",t.UserChannelID),$.ajax({url:"/Channel/UploadFile",type:"POST",data:i,processData:!1,contentType:!1,success:function(){reload();setGrid()},error:function(){}}),[!0,"",!1]}function linkformatter(n,t,i){return n?'<a href="/'+n+'" target="_blank" title="Детальная информация о телеканале '+i.SystemTitle+'..."><img src="/images/i/channel-prog-25.png" alt="Детальная информация о телеканале '+i.SystemTitle+'" class="ahover"><\/img><\/a>':""}function setGrid(){let n=window.localStorage.getItem("optChans");if(n){for(let t in n)checkedArray.push(n[t]);checkedArray=JSON.parse(window.localStorage.getItem("optChans"))}$("#tblSystemChannelsGrid").jqGrid({url:"Home/GetSystemChannels?tvProgProvider="+$("#userProvider option:selected").val().split(";")[1]+"&progType="+$("#userTypeProg option:selected").val().split(";")[1],datatype:"json",mtype:"GET",success:function(){},error:function(){},colNames:["","","Логотип","Канал","Подробнее","Номер канала"],colModel:[{key:!0,name:"UserChannelID",index:"UserChannelID",width:"0px",hidden:!0},{key:!0,name:"ChannelId",index:"ChannelId",width:"0px",hidden:!0},{key:!1,name:"FileName25",index:"FileName25",sortable:!1,width:"3%",align:"center",formatter:imgTvChannel,editable:!0,edittype:"file",editoptions:{enctype:"multipart/form-data"},search:!1},{key:!1,name:"SystemTitle",index:"SystemTitle",sortable:!0,width:"35%",editable:!1},{key:!1,name:"UrlDetails",index:"UrlDetails",sortable:!1,width:"5%",editable:!1,align:"center",formatter:linkformatter},{key:!1,name:"SysOrderCol",index:"SysOrderCol",sortable:!0,width:"10%",align:"center",editable:!0,hidden:!0}],rowNum:20,loadComplete:function(n){if($(this).find("tr.jqgrow:odd").addClass("alt-green-background"),pageNum=n.page,checkedArray)for(var t=0;t<checkedArray.length;t++)$("#tblSystemChannelsGrid").jqGrid("setSelection",checkedArray[t].rowId,!0);$(window).triggerHandler("resize.jqGrid");$("tr.jqgrow td input","#tblSystemChannelsGrid").on("click",function(){$("#mainToolChannel").show(50);$("#ChannelTool").show(100);$("#ApplyTool").show(100);$("#mainToolChannelBottom").show(50);$("#ChannelToolBottom").show(100);$("#ApplyToolBottom").show(100)})},rowList:[20],height:"auto",width:null,autowidth:!1,rownumbers:!0,autoResizing:{minColWidth:80},viewrecords:!0,multiselect:!0,beforeSelectRow:function(n,t){var i=$("a",t.target);return t.target.tagName.toUpperCase()==="A"||t.target.tagName.toUpperCase()==="IMG"||i.length>0?!1:!0},onSelectRow:function(n,t){let i=$("#tblSystemChannelsGrid").jqGrid("getRowData",n),r={pageNum:pageNum,rowId:n,ChannelId:i.ChannelId};if(checkedArray){if(t){for(let t=0;t<checkedArray.length;t++)if(checkedArray[t].rowId==n)return!1;var u=$("#tblSystemChannelsGrid").getGridParam("selrow"),f=$("#tblSystemChannelsGrid").jqGrid("getInd",u);checkedArray.splice((pageNum-1)*20+f-1,0,r)}else for(let t=0;t<checkedArray.length;t++)if(checkedArray[t].rowId==n){checkedArray.splice(t,1);break}$("#hiddenChannels").val(checkedArray.map(n=>n.ChannelId).join(";"));window.localStorage.setItem("optChans",JSON.stringify(checkedArray))}$("#mainToolChannel").show(50);$("#ChannelTool").show(100);$("#ApplyTool").show(100);$("#mainToolChannelBottom").show(50);$("#ChannelToolBottom").show(100);$("#ApplyToolBottom").show(100)},onSelectAll:function(n,t){for(var r,u,f,i=0;i<n.length;i++)for(r=0;r<checkedArray.length;r++)if(checkedArray[r].pageNum==pageNum&&checkedArray[r].rowId==n[i]){checkedArray.splice(r,1);break}if(t)for(i=0;i<n.length;i++)u=$("#tblSystemChannelsGrid").jqGrid("getRowData",n[i]),f={pageNum:pageNum,rowId:n[i],ChannelId:u.ChannelId},checkedArray.push(f);$("#hiddenChannels").val(checkedArray.map(n=>n.ChannelId).join(";"));window.localStorage.setItem("optChans",JSON.stringify(checkedArray))},caption:"Настройка телеканалов для отображения программы передач | Выберите необходимые телеканалы | Обновите страницу или щёлкните на кнопке «Применить» после выбора",emptyrecords:"Телеканалы не обнаружены",pager:"#systemChannelsPager",loadonce:!1,reloadAfterSubmit:!0,afterSubmit:UploadImage,onInitializeForm:function(n){$(n).attr("method","POST");$(n).attr("action","");$(n).attr("enctype","multipart/form-data")}}).navGrid("#systemChannelsPager",{edit:!1,add:!1,del:!1,search:!1,searchtext:"Поиск телеканала",refresh:!0},{zIndex:100,width:400,caption:"Поиск телеканала",sopt:["cn"],reloadAfterSubmit:!0,closeAfterEdit:!0});jQuery("#tblSystemChannelsGrid").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1,defaultSearch:"cn"});jQuery("#tblSystemChannelsGrid").jqGrid("setGridWidth",$("#mw4").width());jQuery("#tblSystemChannelsGrid").jqGrid("setGridHeight",548);$("input#gs_SystemTitle").attr("placeholder","Начните вводить телеканал...");$("input#gs_SystemTitle").height(25);$("input#gs_SystemTitle").trigger("focus")}function reload(){$("#tblSystemChannelsGrid").trigger("reloadGrid")}function imgTvChannel(n,t,i){return n?getImgTag(n,"Эмблема телеканала "+i.SystemTitle):"<img src='/images/i/satellite_25.png' alt='Эмблема телеканала' height='25px' width='25px' />"}function getImgTag(n,t){return"<img src='"+n+"' alt='"+t+"' height='25px' width='25px' />"}let checkedArray=[];var pageNum=1;$(function(){setGrid();let n=window.localStorage.getItem("optChans"),t=getUuid();if(n&&n.length!=0)try{checkedArray=JSON.parse(n)}catch{checkedArray=[];window.localStorage.setItem("optChans","[]")}n&&checkedArray&&checkedArray.length!=0?$("#infoPanel").hide(100):$("#infoPanel").show(300);$("#choicePnl").show()});$("#ChannelTool").on("click",chAction);$("#ChannelToolBottom").on("click",chAction);$("#ApplyTool").on("click",function(){$("#advertise-rewarded-box-start").show()});$("#ApplyToolBottom").on("click",function(){$("#advertise-rewarded-box-start").show()});